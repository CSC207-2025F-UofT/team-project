Index: users.csv
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>username,password\nMiles,123\nyuan,yuan\njessie,jessie\nhi,1233\ntest,test\ntinatina,tina\nhayato,hayato\nainwd,onawdo\njoyce,joyce\ntest1,test1\ntina,tina\nmiles,miles\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/users.csv b/users.csv
--- a/users.csv	(revision 6de0575353f723ecaf332457e94c945f81fdeb45)
+++ b/users.csv	(date 1763612098053)
@@ -9,5 +9,5 @@
 ainwd,onawdo
 joyce,joyce
 test1,test1
-tina,tina
 miles,miles
+Tina,Tina
Index: src/main/java/app/AppBuilder.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package app;\n\nimport data_access.FileUserDataAccessObject;\nimport entity.UserFactory;\nimport interface_adapter.ViewManagerModel;\nimport interface_adapter.groupchat.*;\nimport interface_adapter.logged_in.ChangePasswordController;\nimport interface_adapter.logged_in.ChangePasswordPresenter;\nimport interface_adapter.logged_in.LoggedInViewModel;\nimport interface_adapter.login.LoginController;\nimport interface_adapter.login.LoginPresenter;\nimport interface_adapter.login.LoginViewModel;\nimport interface_adapter.logout.LogoutController;\nimport interface_adapter.logout.LogoutPresenter;\nimport interface_adapter.messaging.view_history.ViewChatHistoryController;\nimport interface_adapter.messaging.view_history.ViewChatHistoryPresenter;\nimport interface_adapter.signup.SignupController;\nimport interface_adapter.signup.SignupPresenter;\nimport interface_adapter.signup.SignupViewModel;\nimport interface_adapter.user_search.SearchUserController;\nimport interface_adapter.user_search.SearchUserPresenter;\nimport interface_adapter.user_search.SearchUserViewModel;\nimport interface_adapter.messaging.send_m.SendMessageController;\nimport interface_adapter.messaging.send_m.SendMessagePresenter;\nimport use_case.groups.*;\nimport use_case.messaging.send_m.SendMessageInputBoundary;\nimport use_case.messaging.send_m.SendMessageOutputBoundary;\nimport use_case.messaging.send_m.SendMessageInteractor;\nimport interface_adapter.messaging.send_m.ChatViewModel;\n\nimport use_case.messaging.view_history.ViewChatHistoryInputBoundary;\nimport use_case.messaging.view_history.ViewChatHistoryInteractor;\nimport use_case.messaging.view_history.ViewChatHistoryOutputBoundary;\nimport use_case.search_user.SearchUserInputBoundary;\nimport use_case.search_user.SearchUserInteractor;\nimport use_case.search_user.SearchUserOutputBoundary;\nimport use_case.search_user.SearchUserDataAccessInterface;\n\nimport use_case.change_password.ChangePasswordInputBoundary;\nimport use_case.change_password.ChangePasswordInteractor;\nimport use_case.change_password.ChangePasswordOutputBoundary;\nimport use_case.login.LoginInputBoundary;\nimport use_case.login.LoginInteractor;\nimport use_case.login.LoginOutputBoundary;\nimport use_case.logout.LogoutInputBoundary;\nimport use_case.logout.LogoutInteractor;\nimport use_case.logout.LogoutOutputBoundary;\nimport use_case.signup.SignupInputBoundary;\nimport use_case.signup.SignupInteractor;\nimport use_case.signup.SignupOutputBoundary;\nimport view.*;\nimport interface_adapter.logged_in.ChangeUsernameController;\nimport interface_adapter.logged_in.ChangeUsernamePresenter;\nimport use_case.change_username.ChangeUsernameInputBoundary;\nimport use_case.change_username.ChangeUsernameInteractor;\nimport use_case.change_username.ChangeUsernameOutputBoundary;\nimport use_case.change_username.ChangeUsernameUserDataAccessInterface;\n\nimport javax.swing.*;\nimport java.awt.*;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.UUID;\n\npublic class AppBuilder {\n    private final JPanel cardPanel = new JPanel();\n    private final CardLayout cardLayout = new CardLayout();\n    // ChatRepository\n    private final use_case.ports.ChatRepository chatRepository =\n            new interface_adapter.repo.InMemoryChatRepository();\n\n    // MessageRepository\n    private final use_case.ports.MessageRepository messageRepository =\n            new interface_adapter.repo.InMemoryMessageRepository();\n\n    // UserRepository\n    private final use_case.ports.UserRepository userRepository =\n            new interface_adapter.repo.InMemoryUserRepository();\n\n    final UserFactory userFactory = new UserFactory();\n    final ViewManagerModel viewManagerModel = new ViewManagerModel();\n    ViewManager viewManager = new ViewManager(cardPanel, cardLayout, viewManagerModel);\n\n    // DAO version using local file storage\n    final FileUserDataAccessObject userDataAccessObject = new FileUserDataAccessObject(\"users.csv\", userFactory);\n\n    private SignupView signupView;\n    private SignupViewModel signupViewModel;\n    private LoginViewModel loginViewModel;\n    private LoggedInViewModel loggedInViewModel;\n    private LoggedInView loggedInView;\n    private LoginView loginView;\n    private WelcomeView welcomeView;\n    private ChatView chatView;\n    private AccountDetailsView accountDetailsView;\n\n    // Field for the Search User use case\n    private final SearchUserViewModel searchUserViewModel = new SearchUserViewModel();\n    private SearchUserView searchUserView;\n\n    private final GroupChatViewModel groupChatViewModel = new GroupChatViewModel();\n    private ChatSettingView chatSettingView;\n\n    // Field for send message\n    private final ChatViewModel chatViewModel = new ChatViewModel();\n    private ViewChatHistoryController viewChatHistoryController;\n\n    private CreateGroupChatController createGroupChatController;\n\n    private final String messagingUserId;\n    private final String messagingChatId;\n\n    public AppBuilder() {\n        cardPanel.setLayout(cardLayout);\n\n        // Load all users from CSV into the in-memory repository\n        Map<String, entity.User> csvUsers = userDataAccessObject.getAccounts();\n\n        for (entity.User csvUser : csvUsers.values()) {\n            goc.chat.entity.User inMemoryUser = new goc.chat.entity.User(\n                    UUID.randomUUID().toString(),        // Generate unique ID\n                    csvUser.getName(),                   // Username from CSV\n                    csvUser.getName() + \"@example.com\",  // Generate email\n                    \"hash\"                               // Placeholder hash\n            );\n            userRepository.save(inMemoryUser);\n        }\n\n        // Get or create the demo user for messaging\n        Optional<goc.chat.entity.User> demoUserOpt = userRepository.findByUsername(\"demo\");\n        if (demoUserOpt.isPresent()) {\n            messagingUserId = demoUserOpt.get().getId();\n        } else {\n            // If demo user doesn't exist in CSV, create it\n            goc.chat.entity.User me = new goc.chat.entity.User(\n                    \"user-1\", \"demo\", \"demo@example.com\", \"hash\"\n            );\n            me = userRepository.save(me);\n            messagingUserId = me.getId();\n        }\n\n        // Create initial chat\n        entity.Chat c = new entity.Chat(\"chat-1\");\n        c.addParticipant(messagingUserId);\n        c = chatRepository.save(c);\n        messagingChatId = c.getId();\n    }\n\n    public AppBuilder addWelcomeView() {\n        welcomeView = new WelcomeView(viewManagerModel);\n        cardPanel.add(welcomeView, welcomeView.getViewName());\n        return this;\n    }\n\n    public AppBuilder addSignupView() {\n        signupViewModel = new SignupViewModel();\n        signupView = new SignupView(signupViewModel);\n        cardPanel.add(signupView, signupView.getViewName());\n        return this;\n    }\n\n    public AppBuilder addLoginView() {\n        loginViewModel = new LoginViewModel();\n        loginView = new LoginView(loginViewModel, viewManagerModel);\n        cardPanel.add(loginView, loginView.getViewName());\n        return this;\n    }\n\n    public AppBuilder addLoggedInView() {\n        loggedInViewModel = new LoggedInViewModel();\n        loggedInView = new LoggedInView(loggedInViewModel, viewManagerModel);\n        cardPanel.add(loggedInView, loggedInView.getViewName());\n        return this;\n    }\n\n    public AppBuilder addSignupUseCase() {\n        final SignupOutputBoundary signupOutputBoundary = new SignupPresenter(viewManagerModel,\n                signupViewModel, loginViewModel);\n        final SignupInputBoundary userSignupInteractor = new SignupInteractor(\n                userDataAccessObject, signupOutputBoundary, userFactory);\n\n        SignupController controller = new SignupController(userSignupInteractor);\n        signupView.setSignupController(controller);\n        return this;\n    }\n\n    public AppBuilder addLoginUseCase() {\n        final LoginOutputBoundary loginOutputBoundary = new LoginPresenter(viewManagerModel,\n                loggedInViewModel, loginViewModel);\n        final LoginInputBoundary loginInteractor = new LoginInteractor(\n                userDataAccessObject, loginOutputBoundary);\n\n        LoginController loginController = new LoginController(loginInteractor);\n        loginView.setLoginController(loginController);\n        return this;\n    }\n\n    public AppBuilder addChangePasswordUseCase() {\n        final ChangePasswordOutputBoundary changePasswordOutputBoundary = new ChangePasswordPresenter(viewManagerModel,\n                loggedInViewModel);\n\n        final ChangePasswordInputBoundary changePasswordInteractor =\n                new ChangePasswordInteractor(userDataAccessObject, changePasswordOutputBoundary, userFactory);\n\n        ChangePasswordController changePasswordController = new ChangePasswordController(changePasswordInteractor);\n\n        loggedInView.setChangePasswordController(changePasswordController);\n\n        if (accountDetailsView != null) {\n            accountDetailsView.setChangePasswordController(changePasswordController);\n        }\n\n        return this;\n    }\n\n    /**\n     * Adds the Logout Use Case to the application.\n     * @return this builder\n     */\n    public AppBuilder addLogoutUseCase() {\n        final LogoutOutputBoundary logoutOutputBoundary = new LogoutPresenter(viewManagerModel,\n                loggedInViewModel, loginViewModel);\n\n        final LogoutInputBoundary logoutInteractor =\n                new LogoutInteractor(userDataAccessObject, logoutOutputBoundary);\n\n        final LogoutController logoutController = new LogoutController(logoutInteractor);\n\n        loggedInView.setLogoutController(logoutController);\n\n        if (accountDetailsView != null) {\n            accountDetailsView.setLogoutController(logoutController);\n        }\n\n        return this;\n    }\n\n    public JFrame build() {\n        final JFrame application = new JFrame(\"GoChat\");\n        application.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);\n\n        application.add(cardPanel);\n\n        // Set the active view to WelcomeView\n        viewManagerModel.setState(welcomeView.getViewName());\n        viewManagerModel.firePropertyChange();\n\n        return application;\n    }\n\n    public AppBuilder addAccountDetailsView() {\n        accountDetailsView = new AccountDetailsView(viewManagerModel, loggedInViewModel);\n        cardPanel.add(accountDetailsView, accountDetailsView.getViewName());\n        return this;\n    }\n\n    public AppBuilder addChangeUsernameUseCase() {\n        final ChangeUsernameOutputBoundary changeUsernameOutputBoundary =\n                new ChangeUsernamePresenter(loggedInViewModel, viewManagerModel);\n\n        final ChangeUsernameInputBoundary changeUsernameInteractor =\n                new ChangeUsernameInteractor(\n                        (ChangeUsernameUserDataAccessInterface) userDataAccessObject,\n                        changeUsernameOutputBoundary,\n                        userFactory\n                );\n\n        ChangeUsernameController changeUsernameController = new ChangeUsernameController(changeUsernameInteractor);\n\n        if (accountDetailsView != null) {\n            accountDetailsView.setChangeUsernameController(changeUsernameController);\n        }\n\n        return this;\n    }\n\n    /**\n     * Adds the Search User View to the application and instantiates it correctly.\n     * @return this builder\n     */\n    public AppBuilder addSearchUserView() {\n        this.searchUserView = new SearchUserView(\n                viewManagerModel,\n                searchUserViewModel,\n                chatView,              // Make sure chatView exists (call addChatUseCase first)\n                groupChatViewModel     // Pass the groupChatViewModel\n        );\n        cardPanel.add(searchUserView, searchUserView.getViewName());\n        return this;\n    }\n\n    /**\n     * Adds the User Search Use Case to the application.\n     * @return this builder\n     */\n    public AppBuilder addUserSearchUseCase() {\n        final SearchUserOutputBoundary searchUserOutputBoundary =\n                new SearchUserPresenter(searchUserViewModel);\n\n        final SearchUserInputBoundary searchUsersInteractor =\n                new SearchUserInteractor(\n                        (SearchUserDataAccessInterface) userRepository,\n                        searchUserOutputBoundary\n                );\n\n        final SearchUserController searchUserController = new SearchUserController(searchUsersInteractor);\n\n        if (this.searchUserView != null) {\n            this.searchUserView.setUserSearchController(searchUserController);\n        }\n\n        return this;\n    }\n\n    public AppBuilder addChatUseCase() {\n        SendMessageController sendMessageController;\n        // Presenter send and history\n        SendMessageOutputBoundary sendMessagePresenter =\n                new SendMessagePresenter(chatViewModel, viewManagerModel);\n\n        ViewChatHistoryOutputBoundary viewHistoryPresenter =\n                new ViewChatHistoryPresenter(chatViewModel, viewManagerModel);\n\n        // Interactor\n        SendMessageInputBoundary sendMessageInteractor =\n                new SendMessageInteractor(\n                        chatRepository,\n                        messageRepository,\n                        userRepository,\n                        sendMessagePresenter\n                );\n\n        ViewChatHistoryInputBoundary viewHistoryInteractor =\n                new ViewChatHistoryInteractor(\n                        chatRepository,\n                        messageRepository,\n                        userRepository,\n                        viewHistoryPresenter\n                );\n\n        // Controller\n        viewChatHistoryController = new ViewChatHistoryController(viewHistoryInteractor);\n        sendMessageController = new SendMessageController(sendMessageInteractor);\n\n        // view\n        chatView = new ChatView(viewManagerModel, sendMessageController, viewChatHistoryController);\n        chatViewModel.addPropertyChangeListener(chatView);\n        cardPanel.add(chatView, chatView.getViewName());\n\n        chatView.setChatContext(messagingChatId, messagingUserId, \"hi\", false);\n\n        return this;\n    }\n\n    public AppBuilder addChatSettingView() {\n        this.chatSettingView = new ChatSettingView(viewManagerModel);\n        cardPanel.add(chatSettingView, chatSettingView.getViewName());\n        return this;\n    }\n\n    public AppBuilder addChangeGroupNameUseCase() {\n        final ChangeGroupNameOutputBoundary outputBoundary =\n                new ChangeGroupNamePresenter(groupChatViewModel);\n\n        final ChangeGroupNameInputBoundary interactor =\n                new RenameGroupChatInteractor(\n                        chatRepository,\n                        outputBoundary\n                );\n\n        final ChangeGroupNameController controller =\n                new ChangeGroupNameController(interactor);\n\n        // Wire controller to the view\n        if (this.chatSettingView != null) {\n            this.chatSettingView.setChangeGroupNameController(controller);\n        }\n\n        return this;\n    }\n\n    public AppBuilder addCreateGroupChatUseCase() {\n        // Output Boundary\n        final CreateGroupChatOutputBoundary outputBoundary =\n                new CreateGroupChatPresenter(groupChatViewModel, viewManagerModel);\n\n        // Interactor\n        final CreateGroupChatInputBoundary interactor =\n                new CreateGroupChatInteractor(\n                        chatRepository,\n                        userRepository,\n                        outputBoundary\n                );\n\n        // Controller\n        createGroupChatController = new CreateGroupChatController(interactor);\n\n        // Wire controller to SearchUserView\n        if (searchUserView != null) {\n            searchUserView.setCreateGroupChatController(createGroupChatController);\n        }\n\n        return this;\n    }\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/app/AppBuilder.java b/src/main/java/app/AppBuilder.java
--- a/src/main/java/app/AppBuilder.java	(revision 6de0575353f723ecaf332457e94c945f81fdeb45)
+++ b/src/main/java/app/AppBuilder.java	(date 1763612291334)
@@ -14,6 +14,7 @@
 import interface_adapter.logout.LogoutPresenter;
 import interface_adapter.messaging.view_history.ViewChatHistoryController;
 import interface_adapter.messaging.view_history.ViewChatHistoryPresenter;
+import interface_adapter.repo.InMemoryMessageRepository;
 import interface_adapter.signup.SignupController;
 import interface_adapter.signup.SignupPresenter;
 import interface_adapter.signup.SignupViewModel;
@@ -56,6 +57,11 @@
 import use_case.change_username.ChangeUsernameOutputBoundary;
 import use_case.change_username.ChangeUsernameUserDataAccessInterface;
 
+import com.google.cloud.firestore.Firestore;
+import data_access.FirebaseClientProvider;
+import interface_adapter.repo.FirebaseMessageRepository;
+import use_case.ports.MessageRepository;
+
 import javax.swing.*;
 import java.awt.*;
 import java.util.Map;
@@ -70,8 +76,7 @@
             new interface_adapter.repo.InMemoryChatRepository();
 
     // MessageRepository
-    private final use_case.ports.MessageRepository messageRepository =
-            new interface_adapter.repo.InMemoryMessageRepository();
+    private final MessageRepository messageRepository;
 
     // UserRepository
     private final use_case.ports.UserRepository userRepository =
@@ -113,6 +118,24 @@
     public AppBuilder() {
         cardPanel.setLayout(cardLayout);
 
+        MessageRepository repo;
+        try {
+            com.google.cloud.firestore.Firestore db =
+                    data_access.FirebaseClientProvider.getFirestore();
+            repo = new interface_adapter.repo.FirebaseMessageRepository(db);
+            System.out.println("Using FirebaseMessageRepository");
+        } catch (Exception e) {
+            e.printStackTrace();
+            repo = new interface_adapter.repo.InMemoryMessageRepository();
+            System.out.println("Fallback to InMemoryMessageRepository");
+        }
+        this.messageRepository = repo;
+
+        // Use repo to store
+        goc.chat.entity.User me =
+                new goc.chat.entity.User("user-1", "demo", "demo@example.com", "hash");
+        me = userRepository.save(me);
+        messagingUserId = me.getId();
         // Load all users from CSV into the in-memory repository
         Map<String, entity.User> csvUsers = userDataAccessObject.getAccounts();
 
@@ -343,7 +366,7 @@
         sendMessageController = new SendMessageController(sendMessageInteractor);
 
         // view
-        chatView = new ChatView(viewManagerModel, sendMessageController, viewChatHistoryController);
+        chatView = new ChatView(viewManagerModel, loggedInViewModel, sendMessageController, viewChatHistoryController);
         chatViewModel.addPropertyChangeListener(chatView);
         cardPanel.add(chatView, chatView.getViewName());
 
Index: src/main/java/view/ChatView.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package view;\n\nimport interface_adapter.ViewManagerModel;\nimport interface_adapter.messaging.send_m.SendMessageController;\nimport interface_adapter.messaging.send_m.ChatState;\nimport interface_adapter.messaging.view_history.ViewChatHistoryController;\nimport use_case.messaging.ChatMessageDto;\nimport java.util.List;\nimport javax.swing.*;\nimport java.awt.*;\nimport java.awt.event.ActionEvent;\nimport java.awt.event.ActionListener;\nimport java.beans.PropertyChangeEvent;\nimport java.beans.PropertyChangeListener;\n\npublic class ChatView extends JPanel implements ActionListener, PropertyChangeListener {\n\n    public final String viewName = \"chat\";\n    private final ViewManagerModel viewManagerModel;\n    private final SendMessageController sendMessageController;\n    private final ViewChatHistoryController viewChatHistoryController;\n\n    private String currentChatId;\n    private String currentUserId;\n    private boolean isGroupChat;\n\n    // Components\n    private final JLabel chatPartnerLabel; // Displays the name of the user you're chatting with\n    private final JTextArea messageInputField;\n    private final JButton sendButton;\n    private final JButton settingButton;\n\n    // Use this to display the initial prompt or history\n    private final JPanel chatDisplayPanel;\n    private final JLabel initialPrompt;\n\n    public ChatView(ViewManagerModel viewManagerModel, SendMessageController sendMessageController,\n                    interface_adapter.messaging.view_history.ViewChatHistoryController viewChatHistoryController) {\n        this.viewManagerModel = viewManagerModel;\n        this.sendMessageController = sendMessageController;\n        this.viewChatHistoryController = viewChatHistoryController;\n        this.setLayout(new BorderLayout());\n\n        // Top Bar (Chat Partner and Exit/Back Button)\n        JPanel topBar = new JPanel(new BorderLayout());\n        topBar.setBorder(BorderFactory.createEmptyBorder(10, 10, 10, 10));\n\n        // Left Side: Chat Partner Name (Placeholder)\n        JPanel partnerInfoPanel = new JPanel(new FlowLayout(FlowLayout.LEFT));\n        // Using the Profile icon again, but this time for the chat partner\n        JLabel partnerIcon = new JLabel(\"\uD83D\uDC64\");\n        partnerIcon.setFont(new Font(\"SansSerif\", Font.PLAIN, 24));\n        chatPartnerLabel = new JLabel(\"User\"); // Placeholder\n        chatPartnerLabel.setFont(new Font(\"SansSerif\", Font.BOLD, 18));\n\n        // Right Side: Back/Exit Button (Go back to LoggedInView/Recent Chats)\n        JButton backButton = new JButton(\"⬅\");\n        backButton.setFont(new Font(\"SansSerif\", Font.BOLD, 20));\n\n        backButton.addActionListener(e -> {\n            // Navigate back to the LoggedInView\n            viewManagerModel.setState(\"logged in\");\n            viewManagerModel.firePropertyChange();\n        });\n\n        partnerInfoPanel.add(backButton);\n        partnerInfoPanel.add(partnerIcon);\n        partnerInfoPanel.add(chatPartnerLabel);\n        topBar.add(partnerInfoPanel, BorderLayout.WEST);\n\n        // Right Side: Back/Exit Button (Go back to LoggedInView/Recent Chats)\n        settingButton = new JButton(\"⛭\");  // NEW - assigns to field\n        settingButton.setFont(new Font(\"SansSerif\", Font.BOLD, 20));\n\n        settingButton.addActionListener(e -> {\n            viewManagerModel.setState(\"chat setting\");\n            viewManagerModel.firePropertyChange();\n        });\n\n\n        topBar.add(settingButton, BorderLayout.EAST);\n\n        // Chat Display Area (Main Content)\n        chatDisplayPanel = new JPanel();\n        // change to y-axis display frame\n        chatDisplayPanel.setLayout(new BoxLayout(chatDisplayPanel, BoxLayout.Y_AXIS));\n\n        // Initial Prompt: \"Send 'User' a message to start a chat!\"\n        initialPrompt = new JLabel(\"<html><div style='text-align: center;'>Send \\\"\" + chatPartnerLabel.getText() +\n                \"\\\" a message to start a chat!</div></html>\");\n        initialPrompt.setFont(new Font(\"SansSerif\", Font.ITALIC, 16));\n\n        chatDisplayPanel.add(initialPrompt);\n\n        JScrollPane chatScrollPane = new JScrollPane(chatDisplayPanel);\n        chatScrollPane.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED);\n        chatScrollPane.setBorder(BorderFactory.createEmptyBorder());\n\n        // Input Panel (Text field and Send Button)\n        JPanel inputPanel = new JPanel(new BorderLayout(5, 5));\n        inputPanel.setBorder(BorderFactory.createEmptyBorder(5, 10, 10, 10)); // Padding\n\n        messageInputField = new JTextArea(3, 1);\n        messageInputField.setLineWrap(true);\n        messageInputField.setWrapStyleWord(true);\n        JScrollPane inputScrollPane = new JScrollPane(messageInputField);\n\n        sendButton = new JButton(\"Send\");\n        sendButton.setFont(new Font(\"SansSerif\", Font.BOLD, 14));\n        sendButton.setPreferredSize(new Dimension(80, inputScrollPane.getPreferredSize().height));\n\n        sendButton.addActionListener(this);\n\n        inputPanel.add(inputScrollPane, BorderLayout.CENTER);\n        inputPanel.add(sendButton, BorderLayout.EAST);\n\n        // Assembly\n        this.add(topBar, BorderLayout.NORTH);\n        this.add(chatScrollPane, BorderLayout.CENTER);\n        this.add(inputPanel, BorderLayout.SOUTH);\n    }\n\n    @Override\n    public void actionPerformed(ActionEvent evt) {\n        if (evt.getSource().equals(sendButton)) {\n            String message = messageInputField.getText().trim();\n            if (!message.isEmpty()) {\n                sendMessageController.execute(currentChatId, currentUserId, message);\n                messageInputField.setText(\"\");\n            }\n        }\n    }\n\n    @Override\n    public void propertyChange(PropertyChangeEvent evt) {\n        if (!\"state\".equals(evt.getPropertyName())) {\n            return;\n        }\n\n        Object newValue = evt.getNewValue();\n        if (!(newValue instanceof ChatState)) {\n            return;\n        }\n\n        ChatState state = (ChatState) newValue;\n\n        // remove previous ui\n        chatDisplayPanel.removeAll();\n\n        if (state.getError() != null) {\n            JLabel errorLabel = new JLabel(state.getError());\n            errorLabel.setForeground(Color.RED);\n            chatDisplayPanel.add(errorLabel);\n        } else {\n            List<ChatMessageDto> messages = state.getMessages();\n\n            if (messages.isEmpty()) {\n                chatDisplayPanel.add(initialPrompt);\n            } else {\n                for (ChatMessageDto msg : messages) {\n                    boolean fromCurrentUser =\n                            msg.getSenderUserId().equals(currentUserId);\n\n                    JPanel row = new JPanel(new BorderLayout());\n                    row.setOpaque(false);\n                    row.setBorder(BorderFactory.createEmptyBorder(5, 10, 5, 10));\n\n                    String displayText = msg.getContent();\n                    if (isGroupChat && !fromCurrentUser) {\n                        displayText = msg.getSenderName() + \": \" + msg.getContent();\n                    }\n\n                    JLabel bubble = new JLabel(\"<html>\" + displayText + \"</html>\");\n\n                    bubble.setOpaque(true);\n                    bubble.setBorder(BorderFactory.createEmptyBorder(8, 10, 8, 10));\n\n                    if (fromCurrentUser) {\n                        bubble.setBackground(new Color(0x95EC69));\n                        // green\n                        bubble.setForeground(Color.BLACK);\n                        row.add(bubble, BorderLayout.EAST);\n                    } else {\n                        bubble.setBackground(new Color(230, 230, 230));\n                        // black\n                        bubble.setForeground(Color.BLACK);\n                        row.add(bubble, BorderLayout.WEST);\n                    }\n                    chatDisplayPanel.add(row);\n                }\n            }\n        }\n        chatDisplayPanel.revalidate();\n        chatDisplayPanel.repaint();\n    }\n\n    public String getViewName() {\n        return viewName;\n    }\n\n    /**\n     * Public method to set the chat partner's username and update the view.\n     * @param username The username of the chat partner.\n     */\n    public void setChatPartner(String username) {\n        this.chatPartnerLabel.setText(username);\n        // Update the initial prompt to reflect the new user\n        this.initialPrompt.setText(\"<html><div style='text-align: center;'>Send \\\"\" + username +\n                \"\\\" a message to start a chat!</div></div>\");\n        this.revalidate();\n        this.repaint();\n    }\n\n    public void setChatContext(String chatId, String currentUserId, String partnerUsername, boolean isGroupChat) {\n        this.currentChatId = chatId;\n        this.currentUserId = currentUserId;\n        this.isGroupChat = isGroupChat;\n        setChatPartner(partnerUsername);\n\n        // Show/hide settings button based on chat type\n        settingButton.setVisible(isGroupChat);\n\n        viewChatHistoryController.execute(chatId);\n    }\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/view/ChatView.java b/src/main/java/view/ChatView.java
--- a/src/main/java/view/ChatView.java	(revision 6de0575353f723ecaf332457e94c945f81fdeb45)
+++ b/src/main/java/view/ChatView.java	(date 1763612098052)
@@ -1,10 +1,13 @@
 package view;
 
 import interface_adapter.ViewManagerModel;
+import interface_adapter.logged_in.LoggedInState;
+import interface_adapter.logged_in.LoggedInViewModel;
 import interface_adapter.messaging.send_m.SendMessageController;
 import interface_adapter.messaging.send_m.ChatState;
 import interface_adapter.messaging.view_history.ViewChatHistoryController;
 import use_case.messaging.ChatMessageDto;
+
 import java.util.List;
 import javax.swing.*;
 import java.awt.*;
@@ -17,6 +20,7 @@
 
     public final String viewName = "chat";
     private final ViewManagerModel viewManagerModel;
+    private final LoggedInViewModel loggedInViewModel;
     private final SendMessageController sendMessageController;
     private final ViewChatHistoryController viewChatHistoryController;
 
@@ -34,13 +38,26 @@
     private final JPanel chatDisplayPanel;
     private final JLabel initialPrompt;
 
-    public ChatView(ViewManagerModel viewManagerModel, SendMessageController sendMessageController,
+    public ChatView(ViewManagerModel viewManagerModel, LoggedInViewModel loggedInViewModel, SendMessageController sendMessageController,
                     interface_adapter.messaging.view_history.ViewChatHistoryController viewChatHistoryController) {
         this.viewManagerModel = viewManagerModel;
+        this.loggedInViewModel = loggedInViewModel;
         this.sendMessageController = sendMessageController;
         this.viewChatHistoryController = viewChatHistoryController;
         this.setLayout(new BorderLayout());
 
+        // Keep the current username updated.
+        //this.viewManagerModel.addPropertyChangeListener(
+        //        e -> this.currentChatId = e.getNewValue().toString()
+        //);
+
+        //this.loggedInViewModel.addPropertyChangeListener(
+        //        e -> {
+        //            System.out.println();
+        //            this.currentUserId = ((LoggedInState) e.getNewValue()).getUsername();
+        //        }
+        //);
+
         // Top Bar (Chat Partner and Exit/Back Button)
         JPanel topBar = new JPanel(new BorderLayout());
         topBar.setBorder(BorderFactory.createEmptyBorder(10, 10, 10, 10));
@@ -161,6 +178,8 @@
                     boolean fromCurrentUser =
                             msg.getSenderUserId().equals(currentUserId);
 
+                    System.out.println("sender: " + msg.getSenderUserId() + " current user id: " + currentUserId + " current chat id: " + currentChatId);
+
                     JPanel row = new JPanel(new BorderLayout());
                     row.setOpaque(false);
                     row.setBorder(BorderFactory.createEmptyBorder(5, 10, 5, 10));
Index: src/main/java/data_access/DBMessageDataAccessObject.java
===================================================================
diff --git a/src/main/java/data_access/DBMessageDataAccessObject.java b/src/main/java/data_access/DBMessageDataAccessObject.java
deleted file mode 100644
--- a/src/main/java/data_access/DBMessageDataAccessObject.java	(revision 6de0575353f723ecaf332457e94c945f81fdeb45)
+++ /dev/null	(revision 6de0575353f723ecaf332457e94c945f81fdeb45)
@@ -1,158 +0,0 @@
-package data_access;
-
-import entity.Message;
-import okhttp3.*;
-import org.json.JSONArray;
-import org.json.JSONException;
-import org.json.JSONObject;
-import use_case.ports.MessageRepository;
-
-import java.io.IOException;
-import java.time.Instant;
-import java.util.ArrayList;
-import java.util.List;
-import java.util.Optional;
-
-// I didn;t use this actually
-public class DBMessageDataAccessObject implements MessageRepository {
-
-    private static final int SUCCESS_CODE = 200;
-    private static final String CONTENT_TYPE_LABEL = "Content-Type";
-    private static final String CONTENT_TYPE_JSON = "application/json";
-    private static final String STATUS_CODE_LABEL = "status_code";
-    private static final String MESSAGE_LABEL = "message";
-
-    private static final String BASE_URL = "http://vm003.teach.cs.toronto.edu:20112";
-    private static final String PATH_MESSAGE = "/message";
-    private static final String PATH_MESSAGES_BY_CHAT = "/messages";
-
-    @Override
-    public Optional<Message> findById(String id) {
-        final OkHttpClient client = new OkHttpClient().newBuilder().build();
-
-        final String url = String.format("%s%s?id=%s", BASE_URL, PATH_MESSAGE, id);
-
-        final Request request = new Request.Builder()
-                .url(url)
-                .addHeader(CONTENT_TYPE_LABEL, CONTENT_TYPE_JSON)
-                .build();
-        try (Response response = client.newCall(request).execute()) {
-
-            final JSONObject responseBody = new JSONObject(response.body().string());
-
-            if (responseBody.getInt(STATUS_CODE_LABEL) != SUCCESS_CODE) {
-                return Optional.empty();
-            }
-
-            final JSONObject msgJson = responseBody.getJSONObject("message");
-            return Optional.of(jsonToMessage(msgJson));
-        }
-        catch (IOException | JSONException ex) {
-            throw new RuntimeException(ex);
-        }
-    }
-
-    @Override
-    public Message save(Message message) {
-        final OkHttpClient client = new OkHttpClient().newBuilder().build();
-
-        final JSONObject requestBody = new JSONObject();
-        requestBody.put("id", message.getId());
-        requestBody.put("chat_id", message.getChatId());
-        requestBody.put("sender_user_id", message.getSenderUserId());
-        requestBody.put("content", message.getContent());
-        requestBody.put("timestamp", message.getTimestamp().toString());
-
-        final MediaType mediaType = MediaType.parse(CONTENT_TYPE_JSON);
-        final RequestBody body = RequestBody.create(requestBody.toString(), mediaType);
-
-        final String url = BASE_URL + PATH_MESSAGE;
-
-        final Request request = new Request.Builder()
-                .url(url)
-                .method("POST", body)
-                .addHeader(CONTENT_TYPE_LABEL, CONTENT_TYPE_JSON)
-                .build();
-        try (Response response = client.newCall(request).execute()) {
-
-            final JSONObject responseBody = new JSONObject(response.body().string());
-
-            if (responseBody.getInt(STATUS_CODE_LABEL) != SUCCESS_CODE) {
-                throw new RuntimeException(responseBody.getString(MESSAGE_LABEL));
-            }
-
-            final JSONObject msgJson = responseBody.getJSONObject("message");
-            return jsonToMessage(msgJson);
-        }
-        catch (IOException | JSONException ex) {
-            throw new RuntimeException(ex);
-        }
-    }
-
-    @Override
-    public List<Message> findByChatId(String chatId) {
-        final OkHttpClient client = new OkHttpClient().newBuilder().build();
-
-        final String url = String.format("%s%s?chatId=%s", BASE_URL, PATH_MESSAGES_BY_CHAT, chatId);
-
-        final Request request = new Request.Builder()
-                .url(url)
-                .addHeader(CONTENT_TYPE_LABEL, CONTENT_TYPE_JSON)
-                .build();
-        try (Response response = client.newCall(request).execute()) {
-
-            final JSONObject responseBody = new JSONObject(response.body().string());
-
-            if (responseBody.getInt(STATUS_CODE_LABEL) != SUCCESS_CODE) {
-                return new ArrayList<>();
-            }
-
-            final JSONArray array = responseBody.getJSONArray("messages");
-            final List<Message> result = new ArrayList<>();
-
-            for (int i = 0; i < array.length(); i++) {
-                final JSONObject msgJson = array.getJSONObject(i);
-                result.add(jsonToMessage(msgJson));
-            }
-
-            return result;
-        }
-        catch (IOException | JSONException ex) {
-            throw new RuntimeException(ex);
-        }
-    }
-
-    @Override
-    public void deleteById(String id) {
-        final OkHttpClient client = new OkHttpClient().newBuilder().build();
-
-        final String url = String.format("%s%s?id=%s", BASE_URL, PATH_MESSAGE, id);
-
-        final Request request = new Request.Builder()
-                .url(url)
-                .method("DELETE", null)
-                .addHeader(CONTENT_TYPE_LABEL, CONTENT_TYPE_JSON)
-                .build();
-        try (Response response = client.newCall(request).execute()) {
-
-            final JSONObject responseBody = new JSONObject(response.body().string());
-
-            if (responseBody.getInt(STATUS_CODE_LABEL) != SUCCESS_CODE) {
-                throw new RuntimeException(responseBody.getString(MESSAGE_LABEL));
-            }
-        }
-        catch (IOException | JSONException ex) {
-            throw new RuntimeException(ex);
-        }
-    }
-
-    private Message jsonToMessage(JSONObject json) {
-        final String id = json.getString("id");
-        final String chatId = json.getString("chat_id");
-        final String senderUserId = json.getString("sender_user_id");
-        final String content = json.getString("content");
-        final Instant timestamp = Instant.parse(json.getString("timestamp"));
-
-        return new Message(id, chatId, senderUserId, content, timestamp);
-    }
-}
Index: pom.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n    <groupId>org.example</groupId>\n    <artifactId>TeamProject</artifactId>\n    <version>1.0-SNAPSHOT</version>\n\n    <dependencies>\n\n        <dependency>\n            <groupId>com.google.code.gson</groupId>\n            <artifactId>gson</artifactId>\n            <version>2.11.0</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.json</groupId>\n            <artifactId>json</artifactId>\n            <version>20240303</version>\n        </dependency>\n\n        <dependency>\n            <groupId>com.squareup.okhttp3</groupId>\n            <artifactId>okhttp</artifactId>\n            <version>4.12.0</version>\n        </dependency>\n        <dependency>\n            <groupId>org.junit.jupiter</groupId>\n            <artifactId>junit-jupiter</artifactId>\n            <version>5.8.1</version>\n            <scope>test</scope>\n        </dependency>\n\n    </dependencies>\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <configuration>\n                    <source>15</source>\n                    <target>15</target>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n\n    <properties>\n        <maven.compiler.source>11</maven.compiler.source>\n        <maven.compiler.target>11</maven.compiler.target>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n    </properties>\n\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/pom.xml b/pom.xml
--- a/pom.xml	(revision 6de0575353f723ecaf332457e94c945f81fdeb45)
+++ b/pom.xml	(date 1763612098050)
@@ -22,6 +22,12 @@
             <version>20240303</version>
         </dependency>
 
+        <dependency>
+            <groupId>com.google.firebase</groupId>
+            <artifactId>firebase-admin</artifactId>
+            <version>9.2.0</version>
+        </dependency>
+
         <dependency>
             <groupId>com.squareup.okhttp3</groupId>
             <artifactId>okhttp</artifactId>
Index: src/main/java/interface_adapter/logged_in/LoggedInViewModel.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package interface_adapter.logged_in;\n\nimport interface_adapter.ViewModel;\n\nimport java.beans.PropertyChangeListener;\nimport java.beans.PropertyChangeSupport;\n\n/**\n * The View Model for the Logged In View.\n */\npublic class LoggedInViewModel extends ViewModel<LoggedInState> {\n\n    private final PropertyChangeSupport support = new PropertyChangeSupport(this);\n\n    public LoggedInViewModel() {\n        super(\"logged in\");\n        setState(new LoggedInState());\n    }\n\n    /**\n     * Fires a property change event with the given property name.\n     * This is used for specific state updates (like \"username\" or \"password\").\n     * @param propertyName The name of the property that changed.\n     */\n    public void firePropertyChanged(String propertyName) {\n        support.firePropertyChange(propertyName, null, this.getState());\n    }\n\n    @Override\n    public void addPropertyChangeListener(PropertyChangeListener listener) {\n        support.addPropertyChangeListener(listener);\n    }\n\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/interface_adapter/logged_in/LoggedInViewModel.java b/src/main/java/interface_adapter/logged_in/LoggedInViewModel.java
--- a/src/main/java/interface_adapter/logged_in/LoggedInViewModel.java	(revision 6de0575353f723ecaf332457e94c945f81fdeb45)
+++ b/src/main/java/interface_adapter/logged_in/LoggedInViewModel.java	(date 1763612098051)
@@ -22,7 +22,7 @@
      * This is used for specific state updates (like "username" or "password").
      * @param propertyName The name of the property that changed.
      */
-    public void firePropertyChanged(String propertyName) {
+    public void firePropertyChange(String propertyName) {
         support.firePropertyChange(propertyName, null, this.getState());
     }
 
Index: .gitignore
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>target/\n!.mvn/wrapper/maven-wrapper.jar\n!**/src/main/**/target/\n!**/src/test/**/target/\n\n### IntelliJ IDEA ###\n.idea/modules.xml\n.idea/workspace.xml\n.idea/jarRepositories.xml\n.idea/compiler.xml\n.idea/libraries/\n*.iws\n*.iml\n*.ipr\n\n### Eclipse ###\n.apt_generated\n.classpath\n.factorypath\n.project\n.settings\n.springBeans\n.sts4-cache\n\n### NetBeans ###\n/nbproject/private/\n/nbbuild/\n/dist/\n/nbdist/\n/.nb-gradle/\nbuild/\n!**/src/main/**/build/\n!**/src/test/**/build/\n\n### VS Code ###\n.vscode/\n\n### Mac OS ###\n.DS_Store\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.gitignore b/.gitignore
--- a/.gitignore	(revision 6de0575353f723ecaf332457e94c945f81fdeb45)
+++ b/.gitignore	(date 1763612098049)
@@ -37,3 +37,6 @@
 
 ### Mac OS ###
 .DS_Store
+
+### Firebase
+src/main/resources/serviceAccountKey.json
\ No newline at end of file
Index: src/main/java/view/LoggedInView.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// LoggedInView.java (Only showing the necessary changes/additions)\npackage view;\n\nimport interface_adapter.ViewManagerModel; // <-- NEW IMPORT NEEDED\nimport interface_adapter.logged_in.ChangePasswordController;\nimport interface_adapter.logged_in.LoggedInState;\nimport interface_adapter.logged_in.LoggedInViewModel;\nimport interface_adapter.logout.LogoutController;\n\nimport javax.swing.*;\nimport java.awt.*;\nimport java.awt.event.ActionEvent;\nimport java.awt.event.ActionListener;\nimport java.beans.PropertyChangeEvent;\nimport java.beans.PropertyChangeListener;\n\n/**\n * The View for when the user is logged into the program, now displaying the chat list.\n */\npublic class LoggedInView extends JPanel implements ActionListener, PropertyChangeListener {\n\n    private final String viewName = \"logged in\";\n    private final LoggedInViewModel loggedInViewModel;\n    // Removed passwordErrorField\n    private ChangePasswordController changePasswordController = null;\n    private LogoutController logoutController;\n    private final ViewManagerModel viewManagerModel;\n\n    // Components for the New Design\n    private final JLabel usernameLabel;\n    private final JList<String> recentChatsList;\n    private final JPanel recentPanel;\n    private final JButton profileButton;\n    private final JButton newChatButton;\n    private final JButton logOut;\n\n    public LoggedInView(LoggedInViewModel loggedInViewModel, ViewManagerModel viewManagerModel) {\n        this.loggedInViewModel = loggedInViewModel;\n        this.viewManagerModel = viewManagerModel;\n        this.loggedInViewModel.addPropertyChangeListener(this);\n\n        // Top Bar Panel (User, New Chat)\n        JPanel topBar = new JPanel(new BorderLayout(5, 0));\n        topBar.setBorder(BorderFactory.createEmptyBorder(10, 10, 10, 10));\n\n        // Left Side: Profile Button and Username Label\n        JPanel userInfoPanel = new JPanel(new FlowLayout(FlowLayout.LEFT, 5, 0));\n\n        profileButton = new JButton(\"\uD83D\uDC64\");\n        profileButton.setFont(new Font(\"SansSerif\", Font.PLAIN, 24));\n        profileButton.setFocusPainted(false);\n        profileButton.setBorderPainted(false);\n        profileButton.setContentAreaFilled(false);\n\n        usernameLabel = new JLabel(\"User\");\n        usernameLabel.setFont(new Font(\"SansSerif\", Font.BOLD, 18));\n\n        userInfoPanel.add(profileButton);\n        userInfoPanel.add(usernameLabel);\n\n        topBar.add(userInfoPanel, BorderLayout.WEST);\n\n        // Right Side: New Chat Button (Plus Icon)\n        newChatButton = new JButton(\"⊕\");\n        newChatButton.setFont(new Font(\"SansSerif\", Font.PLAIN, 24));\n\n        JPanel newChatPanel = new JPanel(new FlowLayout(FlowLayout.RIGHT, 0, 0));\n        newChatPanel.add(newChatButton);\n\n        topBar.add(newChatPanel, BorderLayout.EAST);\n\n        // Recent Chats Panel\n        JLabel recentChatsTitle = new JLabel(\"Recent Chats\");\n        recentChatsTitle.setFont(new Font(\"SansSerif\", Font.BOLD, 20));\n\n        recentPanel = new JPanel(new FlowLayout(FlowLayout.LEFT));\n        recentPanel.add(recentChatsTitle);\n        recentPanel.setBorder(BorderFactory.createEmptyBorder(10, 10, 0, 10));\n        recentPanel.setMaximumSize(new Dimension(Integer.MAX_VALUE, recentPanel.getPreferredSize().height));\n\n        JSeparator separator = new JSeparator(SwingConstants.HORIZONTAL);\n        separator.setBorder(BorderFactory.createDashedBorder(Color.BLACK));\n        separator.setMaximumSize(new Dimension(Integer.MAX_VALUE, 1));\n\n        recentChatsList = new JList<>(new DefaultListModel<String>());\n        JScrollPane scrollPane = new JScrollPane(recentChatsList);\n        scrollPane.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED);\n        scrollPane.setBorder(BorderFactory.createEmptyBorder());\n\n        JPanel buttonPanel = new JPanel();\n        logOut = new JButton(\"Logout\");\n\n        // PROFILE BUTTON: Navigate to AccountDetailsView\n        profileButton.addActionListener(e -> {\n            viewManagerModel.setState(\"account details\");\n            viewManagerModel.firePropertyChange();\n        });\n\n        // NEW CHAT BUTTON: Navigate to NewChatView\n        newChatButton.addActionListener(e -> {\n            viewManagerModel.setState(\"new chat\");\n            viewManagerModel.firePropertyChange();\n        });\n\n        // LOGOUT BUTTON:\n        logOut.addActionListener(this);\n\n        buttonPanel.add(logOut);\n        buttonPanel.setVisible(false); // Keep hidden\n\n        this.setLayout(new BoxLayout(this, BoxLayout.Y_AXIS));\n\n        this.add(topBar);\n        this.add(recentPanel);\n        this.add(Box.createVerticalStrut(5));\n        this.add(separator);\n        this.add(scrollPane);\n        this.add(buttonPanel);\n    }\n\n    @Override\n    public void actionPerformed(ActionEvent evt) {\n        if (evt.getSource().equals(logOut) && logoutController != null) {\n            logoutController.execute();\n        }\n        System.out.println(\"Click \" + evt.getActionCommand());\n    }\n\n    @Override\n    public void propertyChange(PropertyChangeEvent evt) {\n        if (evt.getPropertyName().equals(\"state\")) {\n            final LoggedInState state = (LoggedInState) evt.getNewValue();\n            usernameLabel.setText(state.getUsername());\n        }\n\n        else if (evt.getPropertyName().equals(\"password\")) {\n            final LoggedInState state = (LoggedInState) evt.getNewValue();\n            if (state.getPasswordError() == null) {\n                // This will show when a password change succeeds\n                JOptionPane.showMessageDialog(this, \"password updated for \" + state.getUsername());\n            }\n            else {\n                JOptionPane.showMessageDialog(this, state.getPasswordError());\n            }\n        }\n    }\n\n    public String getViewName() {\n        return viewName;\n    }\n\n    public void setChangePasswordController(ChangePasswordController changePasswordController) {\n        this.changePasswordController = changePasswordController;\n    }\n\n    public void setLogoutController(LogoutController logoutController) {\n        this.logoutController = logoutController;\n    }\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/view/LoggedInView.java b/src/main/java/view/LoggedInView.java
--- a/src/main/java/view/LoggedInView.java	(revision 6de0575353f723ecaf332457e94c945f81fdeb45)
+++ b/src/main/java/view/LoggedInView.java	(date 1763612098052)
@@ -132,6 +132,21 @@
             final LoggedInState state = (LoggedInState) evt.getNewValue();
             usernameLabel.setText(state.getUsername());
         }
+        else if (evt.getPropertyName().equals("username")) {
+            final LoggedInState state = (LoggedInState) evt.getNewValue();
+
+            if (state.getUsernameError() == null) {
+                JOptionPane.showMessageDialog(this,
+                        "Username successfully updated to " + state.getUsername());
+                usernameLabel.setText(state.getUsername());  // Update label too
+            }
+            else {
+                JOptionPane.showMessageDialog(this,
+                        state.getUsernameError(),
+                        "Username Change Failed",
+                        JOptionPane.ERROR_MESSAGE);
+            }
+        }
 
         else if (evt.getPropertyName().equals("password")) {
             final LoggedInState state = (LoggedInState) evt.getNewValue();
Index: src/main/java/interface_adapter/repo/FirebaseMessageRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/interface_adapter/repo/FirebaseMessageRepository.java b/src/main/java/interface_adapter/repo/FirebaseMessageRepository.java
new file mode 100644
--- /dev/null	(date 1763612098051)
+++ b/src/main/java/interface_adapter/repo/FirebaseMessageRepository.java	(date 1763612098051)
@@ -0,0 +1,121 @@
+package interface_adapter.repo;
+
+import com.google.api.core.ApiFuture;
+import com.google.cloud.firestore.*;
+import entity.Message;
+import use_case.ports.MessageRepository;
+
+import java.time.Instant;
+import java.util.*;
+import java.util.concurrent.ExecutionException;
+
+public class FirebaseMessageRepository implements MessageRepository {
+
+    private static final String COLLECTION = "messages";
+    private final Firestore db;
+
+    private static final String FIELD_CHAT_ID = "chatId";
+    private static final String FIELD_SENDER_ID = "senderUserId";
+    private static final String FIELD_CONTENT = "content";
+    private static final String FIELD_TIMESTAMP = "timestamp"; // stored as epochMillis
+
+    public FirebaseMessageRepository(Firestore db) {
+        this.db = db;
+    }
+
+    @Override
+    public Optional<Message> findById(String id) {
+        try {
+            DocumentReference docRef = db.collection(COLLECTION).document(id);
+            ApiFuture<DocumentSnapshot> future = docRef.get();
+            DocumentSnapshot snapshot = future.get();
+
+            if (!snapshot.exists()) return Optional.empty();
+
+            return Optional.of(toMessage(snapshot));
+        } catch (InterruptedException | ExecutionException e) {
+            throw new RuntimeException("Failed to load message by ID", e);
+        }
+    }
+
+    /** -------------------- SAVE MESSAGE -------------------- **/
+    @Override
+    public Message save(Message message) {
+        try {
+            Map<String, Object> data = new HashMap<>();
+            data.put(FIELD_CHAT_ID, message.getChatId());
+            data.put(FIELD_SENDER_ID, message.getSenderUserId());
+            data.put(FIELD_CONTENT, message.getContent());
+            data.put(FIELD_TIMESTAMP, message.getTimestamp().toEpochMilli());
+
+            CollectionReference col = db.collection(COLLECTION);
+
+            if (message.getId() == null || message.getId().isEmpty()) {
+                // Auto-generate ID
+                ApiFuture<DocumentReference> future = col.add(data);
+                DocumentReference ref = future.get();
+                return message;
+            } else {
+                DocumentReference doc = col.document(message.getId());
+                ApiFuture<WriteResult> future = doc.set(data);
+                future.get();
+                return message;
+            }
+
+        } catch (InterruptedException | ExecutionException e) {
+            throw new RuntimeException("Failed to save message", e);
+        }
+    }
+
+    /** -------------------- FIND MESSAGES BY CHAT ID -------------------- **/
+    @Override
+    public List<Message> findByChatId(String chatId) {
+        try {
+            CollectionReference col = db.collection(COLLECTION);
+
+            Query query = col
+                    .whereEqualTo(FIELD_CHAT_ID, chatId)
+                    .orderBy(FIELD_TIMESTAMP, Query.Direction.ASCENDING);
+
+            ApiFuture<QuerySnapshot> future = query.get();
+            QuerySnapshot snapshot = future.get();
+
+            List<Message> results = new ArrayList<>();
+            for (QueryDocumentSnapshot doc : snapshot.getDocuments()) {
+                results.add(toMessage(doc));
+            }
+
+            return results;
+
+        } catch (InterruptedException | ExecutionException e) {
+            throw new RuntimeException("Failed to load chat messages", e);
+        }
+    }
+
+    /** -------------------- DELETE BY ID -------------------- **/
+    @Override
+    public void deleteById(String id) {
+        try {
+            DocumentReference doc = db.collection(COLLECTION).document(id);
+            ApiFuture<WriteResult> future = doc.delete();
+            future.get();
+        } catch (InterruptedException | ExecutionException e) {
+            throw new RuntimeException("Failed to delete message", e);
+        }
+    }
+
+    /** -------------------- HELPER: Convert Firebase Doc → Message -------------------- **/
+    private Message toMessage(DocumentSnapshot doc) {
+        String id = doc.getId();
+        String chatId = doc.getString(FIELD_CHAT_ID);
+        String senderId = doc.getString(FIELD_SENDER_ID);
+        String content = doc.getString(FIELD_CONTENT);
+
+        Long timeMs = doc.getLong(FIELD_TIMESTAMP);
+        Instant timestamp = timeMs != null
+                ? Instant.ofEpochMilli(timeMs)
+                : Instant.now();
+
+        return new Message(id, chatId, senderId, content, timestamp);
+    }
+}
Index: src/main/java/interface_adapter/login/LoginPresenter.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package interface_adapter.login;\n\nimport interface_adapter.ViewManagerModel;\nimport interface_adapter.logged_in.LoggedInState;\nimport interface_adapter.logged_in.LoggedInViewModel;\nimport use_case.login.LoginOutputBoundary;\nimport use_case.login.LoginOutputData;\n\n/**\n * The Presenter for the Login Use Case.\n */\npublic class LoginPresenter implements LoginOutputBoundary {\n\n    private final LoginViewModel loginViewModel;\n    private final LoggedInViewModel loggedInViewModel;\n    private final ViewManagerModel viewManagerModel;\n\n    public LoginPresenter(ViewManagerModel viewManagerModel,\n                          LoggedInViewModel loggedInViewModel,\n                          LoginViewModel loginViewModel) {\n        this.viewManagerModel = viewManagerModel;\n        this.loggedInViewModel = loggedInViewModel;\n        this.loginViewModel = loginViewModel;\n    }\n\n    @Override\n    public void prepareSuccessView(LoginOutputData response) {\n        // Get the current LoggedInState\n        LoggedInState loggedInState = loggedInViewModel.getState();\n\n        // Set the Username from the LoginOutputData\n        loggedInState.setUsername(response.getUsername());\n\n        // Update the ViewModel and notify listeners\n        loggedInViewModel.setState(loggedInState);\n        loggedInViewModel.firePropertyChanged(\"state\");\n\n        // Switch to the logged-in view\n        viewManagerModel.setState(loggedInViewModel.getViewName());\n        viewManagerModel.firePropertyChange();\n    }\n\n    @Override\n    public void prepareFailView(String error) {\n        final LoginState loginState = loginViewModel.getState();\n        loginState.setLoginError(error);\n        loginViewModel.firePropertyChange();\n    }\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/interface_adapter/login/LoginPresenter.java b/src/main/java/interface_adapter/login/LoginPresenter.java
--- a/src/main/java/interface_adapter/login/LoginPresenter.java	(revision 6de0575353f723ecaf332457e94c945f81fdeb45)
+++ b/src/main/java/interface_adapter/login/LoginPresenter.java	(date 1763612098051)
@@ -15,9 +15,11 @@
     private final LoggedInViewModel loggedInViewModel;
     private final ViewManagerModel viewManagerModel;
 
-    public LoginPresenter(ViewManagerModel viewManagerModel,
-                          LoggedInViewModel loggedInViewModel,
-                          LoginViewModel loginViewModel) {
+    public LoginPresenter(
+            ViewManagerModel viewManagerModel,
+            LoggedInViewModel loggedInViewModel,
+            LoginViewModel loginViewModel
+    ) {
         this.viewManagerModel = viewManagerModel;
         this.loggedInViewModel = loggedInViewModel;
         this.loginViewModel = loginViewModel;
@@ -33,9 +35,10 @@
 
         // Update the ViewModel and notify listeners
         loggedInViewModel.setState(loggedInState);
-        loggedInViewModel.firePropertyChanged("state");
+        loggedInViewModel.firePropertyChange("state");
 
         // Switch to the logged-in view
+
         viewManagerModel.setState(loggedInViewModel.getViewName());
         viewManagerModel.firePropertyChange();
     }
Index: src/main/java/interface_adapter/logged_in/ChangeUsernamePresenter.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package interface_adapter.logged_in;\n\nimport interface_adapter.ViewManagerModel;\nimport use_case.change_username.ChangeUsernameOutputBoundary;\nimport use_case.change_username.ChangeUsernameOutputData;\n\npublic class ChangeUsernamePresenter implements ChangeUsernameOutputBoundary {\n    private final LoggedInViewModel loggedInViewModel;\n    private final ViewManagerModel viewManagerModel;\n\n    public ChangeUsernamePresenter(LoggedInViewModel loggedInViewModel, ViewManagerModel viewManagerModel) {\n        this.loggedInViewModel = loggedInViewModel;\n        this.viewManagerModel = viewManagerModel;\n    }\n\n    @Override\n    public void prepareSuccessView(ChangeUsernameOutputData response) {\n        // Update the state with the new username and clear error\n        LoggedInState loggedInState = loggedInViewModel.getState();\n        loggedInState.setUsername(response.getNewUsername());\n        loggedInState.setUsernameError(null);\n\n        // Notify views (LoggedInView and AccountDetailsView) of the successful username change\n        loggedInViewModel.firePropertyChanged(\"username\");\n    }\n\n    @Override\n    public void prepareFailView(String error) {\n        // Update the state with the error message\n        LoggedInState loggedInState = loggedInViewModel.getState();\n        loggedInState.setUsernameError(error);\n\n        // Notify views to display the error\n        loggedInViewModel.firePropertyChanged(\"username\");\n    }\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/interface_adapter/logged_in/ChangeUsernamePresenter.java b/src/main/java/interface_adapter/logged_in/ChangeUsernamePresenter.java
--- a/src/main/java/interface_adapter/logged_in/ChangeUsernamePresenter.java	(revision 6de0575353f723ecaf332457e94c945f81fdeb45)
+++ b/src/main/java/interface_adapter/logged_in/ChangeUsernamePresenter.java	(date 1763612098051)
@@ -21,7 +21,7 @@
         loggedInState.setUsernameError(null);
 
         // Notify views (LoggedInView and AccountDetailsView) of the successful username change
-        loggedInViewModel.firePropertyChanged("username");
+        loggedInViewModel.firePropertyChange("username");
     }
 
     @Override
@@ -31,6 +31,6 @@
         loggedInState.setUsernameError(error);
 
         // Notify views to display the error
-        loggedInViewModel.firePropertyChanged("username");
+        loggedInViewModel.firePropertyChange("username");
     }
 }
\ No newline at end of file
Index: src/main/java/data_access/FirebaseClientProvider.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/data_access/FirebaseClientProvider.java b/src/main/java/data_access/FirebaseClientProvider.java
new file mode 100644
--- /dev/null	(date 1763612098050)
+++ b/src/main/java/data_access/FirebaseClientProvider.java	(date 1763612098050)
@@ -0,0 +1,36 @@
+package data_access;
+
+import com.google.auth.oauth2.GoogleCredentials;
+import com.google.cloud.firestore.Firestore;
+import com.google.cloud.firestore.FirestoreOptions;
+
+import java.io.FileInputStream;
+import java.io.IOException;
+import java.io.InputStream;
+
+public final class FirebaseClientProvider {
+
+    private static Firestore instance;
+
+    private FirebaseClientProvider() {}
+
+    public static synchronized Firestore getFirestore() {
+        if (instance == null) {
+            try (InputStream serviceAccount =
+                         new FileInputStream("src/main/resources/serviceAccountKey.json")) {
+
+                GoogleCredentials credentials = GoogleCredentials.fromStream(serviceAccount);
+
+                FirestoreOptions options = FirestoreOptions.newBuilder()
+                        .setCredentials(credentials)
+                        .setProjectId("gochat-1c0fc")
+                        .build();
+
+                instance = options.getService();
+            } catch (IOException e) {
+                throw new RuntimeException("Failed to init Firestore", e);
+            }
+        }
+        return instance;
+    }
+}
